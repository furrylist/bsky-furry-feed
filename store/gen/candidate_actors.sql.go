// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.18.0
// source: candidate_actors.sql

package gen

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const createCandidateActor = `-- name: CreateCandidateActor :one
INSERT INTO
    candidate_actors (did, created_at, is_artist, comment, status)
VALUES
    ($1, $2, $3, $4, $5)
RETURNING did, created_at, is_artist, comment, is_nsfw, is_hidden, status, current_profile_id
`

type CreateCandidateActorParams struct {
	DID       string
	CreatedAt pgtype.Timestamptz
	IsArtist  bool
	Comment   string
	Status    ActorStatus
}

func (q *Queries) CreateCandidateActor(ctx context.Context, db DBTX, arg CreateCandidateActorParams) (CandidateActor, error) {
	row := db.QueryRow(ctx, createCandidateActor,
		arg.DID,
		arg.CreatedAt,
		arg.IsArtist,
		arg.Comment,
		arg.Status,
	)
	var i CandidateActor
	err := row.Scan(
		&i.DID,
		&i.CreatedAt,
		&i.IsArtist,
		&i.Comment,
		&i.IsNSFW,
		&i.IsHidden,
		&i.Status,
		&i.CurrentProfileID,
	)
	return i, err
}

const createLatestActorProfile = `-- name: CreateLatestActorProfile :exec
WITH ap as (
    INSERT INTO actor_profiles
        (actor_did, id, created_at, indexed_at, display_name, description)
    VALUES
        ($1, $2, $3, $4, $5, $6)
    RETURNING actor_did, id
)
UPDATE candidate_actors ca
SET current_profile_id = (SELECT id FROM ap)
WHERE
    did = (SELECT actor_did FROM ap)
`

type CreateLatestActorProfileParams struct {
	DID         string
	ID          string
	CreatedAt   pgtype.Timestamptz
	IndexedAt   pgtype.Timestamptz
	DisplayName pgtype.Text
	Description pgtype.Text
}

func (q *Queries) CreateLatestActorProfile(ctx context.Context, db DBTX, arg CreateLatestActorProfileParams) error {
	_, err := db.Exec(ctx, createLatestActorProfile,
		arg.DID,
		arg.ID,
		arg.CreatedAt,
		arg.IndexedAt,
		arg.DisplayName,
		arg.Description,
	)
	return err
}

const getCandidateActorByDID = `-- name: GetCandidateActorByDID :one
SELECT did, created_at, is_artist, comment, is_nsfw, is_hidden, status, current_profile_id
FROM
    candidate_actors
WHERE
    did = $1
`

func (q *Queries) GetCandidateActorByDID(ctx context.Context, db DBTX, did string) (CandidateActor, error) {
	row := db.QueryRow(ctx, getCandidateActorByDID, did)
	var i CandidateActor
	err := row.Scan(
		&i.DID,
		&i.CreatedAt,
		&i.IsArtist,
		&i.Comment,
		&i.IsNSFW,
		&i.IsHidden,
		&i.Status,
		&i.CurrentProfileID,
	)
	return i, err
}

const listCandidateActors = `-- name: ListCandidateActors :many
SELECT did, created_at, is_artist, comment, is_nsfw, is_hidden, status, current_profile_id
FROM
    candidate_actors ca
WHERE
    ($1::actor_status IS NULL OR
     ca.status = $1)
ORDER BY
    did
`

func (q *Queries) ListCandidateActors(ctx context.Context, db DBTX, status NullActorStatus) ([]CandidateActor, error) {
	rows, err := db.Query(ctx, listCandidateActors, status)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []CandidateActor
	for rows.Next() {
		var i CandidateActor
		if err := rows.Scan(
			&i.DID,
			&i.CreatedAt,
			&i.IsArtist,
			&i.Comment,
			&i.IsNSFW,
			&i.IsHidden,
			&i.Status,
			&i.CurrentProfileID,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listCandidateActorsRequiringProfileBackfill = `-- name: ListCandidateActorsRequiringProfileBackfill :many
SELECT did, created_at, is_artist, comment, is_nsfw, is_hidden, status, current_profile_id
FROM
    candidate_actors ca
WHERE
    ca.status = 'approved' AND
    ca.current_profile_id IS NULL
ORDER BY
    did
`

func (q *Queries) ListCandidateActorsRequiringProfileBackfill(ctx context.Context, db DBTX) ([]CandidateActor, error) {
	rows, err := db.Query(ctx, listCandidateActorsRequiringProfileBackfill)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []CandidateActor
	for rows.Next() {
		var i CandidateActor
		if err := rows.Scan(
			&i.DID,
			&i.CreatedAt,
			&i.IsArtist,
			&i.Comment,
			&i.IsNSFW,
			&i.IsHidden,
			&i.Status,
			&i.CurrentProfileID,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const updateCandidateActor = `-- name: UpdateCandidateActor :one
UPDATE candidate_actors ca
SET
    status=COALESCE($1, ca.status),
    is_artist=COALESCE($2, ca.is_artist),
    comment=COALESCE($3, ca.comment)
WHERE
    did = $4
RETURNING did, created_at, is_artist, comment, is_nsfw, is_hidden, status, current_profile_id
`

type UpdateCandidateActorParams struct {
	Status   NullActorStatus
	IsArtist pgtype.Bool
	Comment  pgtype.Text
	DID      string
}

func (q *Queries) UpdateCandidateActor(ctx context.Context, db DBTX, arg UpdateCandidateActorParams) (CandidateActor, error) {
	row := db.QueryRow(ctx, updateCandidateActor,
		arg.Status,
		arg.IsArtist,
		arg.Comment,
		arg.DID,
	)
	var i CandidateActor
	err := row.Scan(
		&i.DID,
		&i.CreatedAt,
		&i.IsArtist,
		&i.Comment,
		&i.IsNSFW,
		&i.IsHidden,
		&i.Status,
		&i.CurrentProfileID,
	)
	return i, err
}
